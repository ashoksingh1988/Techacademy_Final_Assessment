pipeline {
    agent any

    environment {
        MAVEN_HOME = 'C:\\\\Program Files\\\\Maven\\\\ApacheMaven\\\\apache-maven-3.9.11'
        JAVA_HOME = 'C:\\\\Program Files\\\\Java\\\\jdk-24'
        PATH = "C:\\\\Program Files\\\\Java\\\\jdk-24\\\\bin;C:\\\\Program Files\\\\Maven\\\\ApacheMaven\\\\apache-maven-3.9.11\\\\bin;${env.PATH}"
    }

    parameters {
        choice(name: 'TEST_SUITE', choices: ['smoke-tests', 'regression-tests'], description: 'Test suite')
        choice(name: 'BROWSER_TYPE', choices: ['chrome', 'firefox', 'edge'], description: 'Browser')
        choice(name: 'ENVIRONMENT', choices: ['qa', 'staging', 'production'], description: 'Environment')
        booleanParam(name: 'HEADLESS_MODE', defaultValue: true, description: 'Headless mode')
    }

    stages {
        stage('Checkout') {
            steps { checkout scm }
        }

        stage('Build & Test') {
            steps {
                dir('java-selenium-automation') {
                    script {
                        def suiteFile = params.TEST_SUITE == 'smoke-tests' ? 'selenium-smoke-tests.xml' : 'selenium-regression-tests.xml'
                        bat "mvn clean test -Dsurefire.suiteXmlFiles=src/test/resources/suites/${suiteFile} -Dbrowser=${params.BROWSER_TYPE} -Denvironment=${params.ENVIRONMENT} -Dheadless=${params.HEADLESS_MODE}"
                    }
                }
            }
        }

        stage('Reports') {
            steps {
                dir('java-selenium-automation') {
                    script {
                        try {
                            archiveArtifacts artifacts: 'target/surefire-reports/**/*,reports/**/*', allowEmptyArchive: true
                            junit testResults: 'target/surefire-reports/*.xml', allowEmptyResults: true
                        } catch (Exception e) {}
                    }
                }
            }
        }

        stage('Notification') {
            steps {
                script {
                    try {
                        emailext(
                            subject: "Selenium Test - ${currentBuild.currentResult}",
                            body: "Build: ${env.BUILD_NUMBER} | Suite: ${params.TEST_SUITE} | Browser: ${params.BROWSER_TYPE}",
                            to: "ashokchandravanshi1988@gmail.com"
                        )
                    } catch (Exception e) {}
                }
            }
        }
    }

    post {
        always { cleanWs() }
        success { echo "Pipeline completed successfully!" }
        failure { echo "Pipeline failed!" }
    }
}
